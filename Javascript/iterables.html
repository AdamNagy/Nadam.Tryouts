<!DOCTYPE html>
<html>
    <head>
        <style>
            html {
                background-color: darkblue;
                color: yellow;
            }

            #console {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
<body>
    <div id="console"></div>
	<script>
        const Console = document.getElementById("console");
        Console.log = function(arg) {
            const p = document.createElement("p");
            p.innerText = arg;

            this.appendChild(p);
        }

        /*
        interface IList {
            [Symbol.iterator]();

            Select();
            Where();
            Take();
            Skip();
            ToDictionary();

            First();
            FirstOrDefault();
        }
        */

        class List {

            backbone = [];
            iterator = undefined;
            evaluated = false;

            constructor(_generator) {
                this.iterator = _generator;
            }

            *[Symbol.iterator] () {
                if( !this.evaluated ) {
                    this.backbone = [];
                    for( let value of this.iterator ) {
                        this.backbone.push(value);
                        yield value;
                    }
                    this.evaluated = true;
                } else {
                    for( let value of this.backbone ) {
                        yield value;
                    }
                }
            }

            *getItartor() {
                for(let item of this.backbone) {
                    Console.log("inside List getIterator");
                    yield item;
                }
            }

            Add(any) {
                this.backbone.push(any);
                this.iterator = this.getItartor();
            }

            *$Take(n) {
                let idx = 0;
                const current = this.evaluated ? this.backbone : this.iterator;
                for(let item of current) {
                    if( idx === n )
                        break;

                    Console.log("inside list Take");
                    yield item;
                    ++idx;
                }
            }

            Take(n) {
                return new List(this.$Take(n));
            }

            *$Where(predicate) {
                const current = this.evaluated ? this.backbone : this.iterator;
                for(let item of current) {
                    if( predicate(item) ) {
                        Console.log("inside list Where");
                        yield item;
                    }
                }
            }

            Where(predicate) {
                return new List(this.$Where(predicate));
            }

            *$Select(selector) {
                const current = this.evaluated ? this.backbone : this.iterator;
                for(let item of current) {
                    Console.log("inside list Select");
                    yield selector(item);
                }
            }

            Select(selector) {
                return new List(this.$Select(selector));
            }

            First(arg) {
                const type = typeof arg;
                switch(type) {
                    case 'function':
                        break;
                        
                    case 'number': 
                        if( arg < 0 ) {

                        } else {

                        }
                        break;

                    default:
                        return this.backbone[0];
                }
            }
        }

        // class Dictionary {
        //     map = new Map();

        //     *[Symbol.iterator] () {
        //         for( let value of map.values() ) {
        //             yield value;
        //         }
        //     }

        //     add(key, value) {
        //         map.set(key, value);
        //     }

        //     map(mapper) {

        //     }
        // }

		function* myIterable() {
            for(let i = 0; ; ++i) {
                Console.log(`inside "myIterable": ${i}`);
                yield i;
            }
        }

        let iterator = myIterable();
        Console.log("using for with 10")
        for(let j = 0; j < 10; ++j) {
            Console.log(iterator.next().value);
        }

        // iterator = myIterable();
        // console.log("using for with 20")
        // for(let j = 0; j < 10; ++j) {
        //     console.log(iterator.next().value);
        // }

        iterator = myIterable();
        // this line gonna fail because map function is defined on array and not on iterable
        // iterator.map((p) => console.log(p));

        Console.log("using object with [Symbol.iterator]");
        const iterable = {
            [Symbol.iterator]: function*() {
                for(let i = 0; i < 10; ++i) {
                    Console.log(`inside "myIterable": ${i}`);
                    yield i;
                }
            }
        }

        for(let k of iterable) {
            Console.log(k);
        }

        const map = new Map();
        map.set("adam", "c# javascript");
        Console.log(map.get("adam"));

        for(let key of map.keys()) {
            Console.log(key);
        }

        for(let key of map.values()) {
            Console.log(key);
        }
	
        Console.log("List");
        var list = new List();
        for(let k = 0; k < 100; ++k) {
            list.Add(k);
        }
        
        
        let taken = list.Take(10).Where((num) => num % 3 === 0).Select((p) => `(${p})`);
        // Console.log(`indexing ${taken[1]}`);

        for(let item of taken) {
            Console.log(item);
        }

        Console.log("Listing again");
        // taken = list.Take(10).Where((num) => num % 3 === 0).Select((p) => `(${p})`);
        for(let item of taken) {
            Console.log(item);
        }

        Console.log("Listing again 2");
        taken2 = taken.Select((p) => `{${p}}`).Take(2);
        for(let item of taken2) {
            Console.log(item);
        }
    </script>
</body>
</html>